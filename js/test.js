let desktopAnimation = [
  [
    { left: "29.2%", top: "22%" },
    { left: "29.2%", top: "32%" },
    { left: "29.2%", top: "41.5%" },
    { left: "29.2%", top: "51.5%" },
    { left: "29.2%", top: "61.2%" },
    { left: "29.2%", top: "71%" },
  ],
  [
    { left: "35.4%", top: " 22%" },
    { left: "35.4%", top: " 32%" },
    { left: "35.4%", top: " 41.5%" },
    { left: "35.4%", top: " 51.5%" },
    { left: "35.4%", top: " 61.2%" },
    { left: "35.4%", top: " 71%" },
  ],
  [
    { left: "41.4%", top: " 22%" },
    { left: "41.4%", top: " 32%" },
    { left: "41.4%", top: " 41.5%" },
    { left: "41.4%", top: " 51.5%" },
    { left: "41.4%", top: " 61.2%" },
    { left: "41.4%", top: " 71%" },
  ],
  [
    { left: "47.4%", top: " 22%" },
    { left: "47.4%", top: " 32%" },
    { left: "47.4%", top: " 41.5%" },
    { left: "47.4%", top: " 51.5%" },
    { left: "47.4%", top: " 61.2%" },
    { left: "47.4%", top: " 71%" },
  ],
  [
    { left: "53.7%", top: " 22%" },
    { left: "53.7%", top: " 32%" },
    { left: "53.7%", top: " 41.5%" },
    { left: "53.7%", top: " 51.5%" },
    { left: "53.7%", top: " 61.2%" },
    { left: "53.7%", top: " 71%" },
  ],
  [
    { left: "59.7%", top: " 22%" },
    { left: "59.7%", top: " 32%" },
    { left: "59.7%", top: " 41.5%" },
    { left: "59.7%", top: " 51.5%" },
    { left: "59.7%", top: " 61.2%" },
    { left: "59.7%", top: " 71%" },
  ],
  [
    { left: "65.9%", Top: " 22%" },
    { left: "65.9%", top: " 32%" },
    { left: "65.9%", top: " 41.5%" },
    { left: "65.9%", top: " 51.5%" },
    { left: "65.9%", top: " 61.2%" },
    { left: "65.9%", top: " 71%" },
  ],
];

let tabletAnimation = [
  [
    { left: "12.2%", top: " 31.5%" },
    { left: "12.2%", top: " 40.1%" },
    { left: "12.2%", top: " 49%" },
    { left: "12.2%", top: " 57.5%" },
    { left: "12.2%", top: " 66.2%" },
    { left: "12.2%", top: "75%" },
  ],
  [
    { left: "23.7%", top: " 31.5%" },
    { left: "23.7%", top: " 40.1%" },
    { left: "23.7%", top: " 49%" },
    { left: "23.7%", top: " 57.5%" },
    { left: "23.7%", top: " 66.2%" },
    { left: "23.7%", top: "75%" },
  ],
  [
    { left: "35.2%", top: " 31.5%" },
    { left: "35.2%", top: " 40.1%" },
    { left: "35.2%", top: " 49%" },
    { left: "35.2%", top: " 57.5%" },
    { left: "35.2%", top: " 66.2%" },
    { left: "35.2%", top: "75%" },
  ],
  [
    { left: "46.5%", top: " 31.5%" },
    { left: "46.5%", top: " 40.1%" },
    { left: "46.5%", top: " 49%" },
    { left: "46.5%", top: " 57.5%" },
    { left: "46.5%", top: " 66.2%" },
    { left: "46.5%", top: "75%" },
  ],
  [
    { left: "58.1%", top: " 31.5%" },
    { left: "58.1%", top: " 40.1%" },
    { left: "58.1%", top: " 49%" },
    { left: "58.1%", top: " 57.5%" },
    { left: "58.1%", top: " 66.2%" },
    { left: "58.1%", top: "75%" },
  ],
  [
    { left: "69.5%", top: " 31.5%" },
    { left: "69.5%", top: " 40.1%" },
    { left: "69.5%", top: " 49%" },
    { left: "69.5%", top: " 57.5%" },
    { left: "69.5%", top: " 66.2%" },
    { left: "69.5%", top: "75%" },
  ],
  [
    { left: "80.9%", top: " 31.5%" },
    { left: "80.9%", top: " 40.1%" },
    { left: "80.9%", top: " 49%" },
    { left: "80.9%", top: " 57.5%" },
    { left: "80.9%", top: " 66.2%" },
    { left: "80.9%", top: "75%" },
  ],
];

let mobileAnimation = [
  [
    { left: "6.5%", top: " 35.8%" },
    { left: "6.5%", top: " 41.8%" },
    { left: "6.5%", top: " 47.3%" },
    { left: "6.5%", top: " 53.3%" },
    { left: "6.5%", top: " 59.1%" },
    { left: "6.5%", top: " 64.8%" },
  ],
  [
    { left: "19.5%", top: " 35.8%" },
    { left: "19.5%", top: " 41.8%" },
    { left: "19.5%", top: " 47.3%" },
    { left: "19.5%", top: " 53.3%" },
    { left: "19.5%", top: " 59.1%" },
    { left: "19.5%", top: " 64.8%" },
  ],
  [
    { left: "31.5%", top: " 35.8%" },
    { left: "31.5%", top: " 41.8%" },
    { left: "31.5%", top: " 47.3%" },
    { left: "31.5%", top: " 53.3%" },
    { left: "31.5%", top: " 59.1%" },
    { left: "31.5%", top: " 64.8%" },
  ],
  [
    { left: "44.5%", top: " 35.8%" },
    { left: "44.5%", top: " 41.8%" },
    { left: "44.5%", top: " 47.3%" },
    { left: "44.5%", top: " 53.3%" },
    { left: "44.5%", top: " 59.1%" },
    { left: "44.5%", top: " 64.8%" },
  ],
  [
    { left: "56.5%", top: " 35.8%" },
    { left: "56.5%", top: " 41.8%" },
    { left: "56.5%", top: " 47.3%" },
    { left: "56.5%", top: " 53.3%" },
    { left: "56.5%", top: " 59.1%" },
    { left: "56.5%", top: " 64.8%" },
  ],
  [
    { left: "69.2%", top: " 35.8%" },
    { left: "69.2%", top: " 41.8%" },
    { left: "69.2%", top: " 47.3%" },
    { left: "69.2%", top: " 53.3%" },
    { left: "69.2%", top: " 59.1%" },
    { left: "69.2%", top: " 64.8%" },
  ],
  [
    { left: "81.5%", top: " 35.8%" },
    { left: "81.5%", top: " 41.8%" },
    { left: "81.5%", top: " 47.3%" },
    { left: "81.5%", top: " 53.3%" },
    { left: "81.5%", top: " 59.1%" },
    { left: "81.5%", top: " 64.8%" },
  ],
];

const gameArray = [
  [0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0],
];




let large = document.getElementById("counter");
let small = document.getElementById("counter1");
let game = document.getElementsByClassName("flex-conter-board");

const drops = document.querySelectorAll(".droppoint");
const counters = document.querySelectorAll(".counters div");
const countersMobile = document.querySelector(".game-counters .mobile");
const countersTablet = document.querySelector(".game-counters .tablet");
const countersDesktop = document.querySelector(".game-counters .desktop");

const countersMobileAll = document.querySelectorAll(".counters .mobile");
const countersTabletAll = document.querySelectorAll("counters .tablet");
const countersDesktopAll = document.querySelectorAll(".counters .desktop");

function animate(element, frames) {
  if (frames.length === 1) {
    frames.push(frames[0]);
  }
  element.animate(frames, {
    duration: 500,
    iterations: 1,
    fill: "forwards",
  });
}

function checkScreenSize() {
  let screen = "";

  if (window.matchMedia("(max-width: 767px)").matches) {
    screen = "mobile";
  }
  if (window.matchMedia("(min-width: 768px) and (max-width: 1439px)").matches) {
    screen = "tablet";
  }
  if (window.matchMedia("(min-width: 1440px)").matches) {
    screen = "desktop";
  }

  return screen;
}

function setDisplayCounters(counters) {
  counters.forEach((item) => {
    item.display = none;
  });
}

function animateOnScreen(element, frameNumber) {
  switch (checkScreenSize()) {
    case "mobile":
      // setDisplayCounters(countersTabletAll);
      // setDisplayCounters(countersDesktopAll);

      animate(element, mobileAnimation[frameNumber]);
      savePlayerMove(element, mobileAnimation[frameNumber], frameNumber);

      break;
    case "tablet":
      // setDisplayCounters(countersMobileAll);
      // setDisplayCounters(countersDesktopAll);
      animate(element, tabletAnimation[frameNumber]);
      savePlayerMove(element, tabletAnimation[frameNumber], frameNumber);

      break;
    case "desktop":
      // setDisplayCounters(countersTabletAll);
      // setDisplayCounters(countersMobileAll);
     
      animate(element, desktopAnimation[frameNumber]);
      savePlayerMove(element, desktopAnimation[frameNumber], frameNumber);
      break;
  }
  setCounterPosition(element, frameNumber);
}

function setCounterPosition(element, frameNumber) {
  let desktop = desktopAnimation[frameNumber].pop();
  let tablet = tabletAnimation[frameNumber].pop();
  let mobile = mobileAnimation[frameNumber].pop();
  const prefix = ["desktop", "tablet", "mobile"];
  let elementNumber = element.id.split("#")[1];
  prefix.forEach((item) => {
    let name = item + "#" + elementNumber;
    let newElement = document.getElementById(name.toString());
    switch (item) {
      case "desktop":
        newElement.style.left = desktop.left;
        newElement.style.top = desktop.top;
        moveCounterToGameBoard(newElement,"desktop");
        break;
      case "tablet":
        newElement.style.left = tablet.left;
        newElement.style.top = tablet.top;
        moveCounterToGameBoard(newElement,"tablet");
        break;
      case "mobile":
        newElement.style.left = mobile.left;
        newElement.style.top = mobile.top;
        moveCounterToGameBoard(newElement,"mobile");
        break;
    }
    
  });

 
}

function moveCounterToGameBoard(element,boardElement)
{
  let board = document.querySelector(".game-counters ."+boardElement);
  board.appendChild(element);

}

drops.forEach((droppoint) => {
  droppoint.addEventListener("dragenter", dragEnter);
  droppoint.addEventListener("dragover", dragOver);
  droppoint.addEventListener("dragleave", dragLeave);
  droppoint.addEventListener("drop", drop);
});
counters.forEach((counter) => {
  counter.addEventListener("dragstart", dragStart);
});

function dragStart(e) {
  e.dataTransfer.setData("text/plain", e.target.id);
}

function dragEnter(e) {
  e.preventDefault();
}

function dragOver(e) {
  e.preventDefault();

  //e.target.classList.add("marker-red-large");
}

function dragLeave(e) {
  e.preventDefault();
  //e.target.classList.remove("marker-red-large");
}

function drop(e) {
  const id = e.dataTransfer.getData("text/plain");
  const dragElement = document.getElementById(id);
  let color = getCounterColor(dragElement);
  animateOnScreen(dragElement, parseInt(e.target.id));

  checkWinner(color);
}

function savePlayerMove(element, animationFrameArr, position) {
 
  gameArray[animationFrameArr.length -1][position] = getCounterColor(element);
}

function getCounterColor(element) {
  return element.id.split("-")[1];
}



function checkMatch(one,two,three,four,color)
{
  if(one === two && one === three && one === four && one === color ) {
    return true;
  }
}

function checkWinner(color) {
  for(let column = 0;column <7;column++) {
    for(let row=0;row<3;row++)
    {
      if(checkMatch(gameArray[row][column],gameArray[row+1][column],gameArray[row+2][column],gameArray[row+3][column],color))
      {
          console.log("win hotizontal"+color);
      }
      if(checkMatch(gameArray[row][column],gameArray[row][column+1],gameArray[row][column+2],gameArray[row][column+3],color))
      {
        console.log("win verticla"+color);
      }
     
    }
  }

  for(let column=0;column<4;column++)
  {
    for(let row=0;row<3;row++)
    {
      if(checkMatch(gameArray[row][column],gameArray[row+1][column+1],gameArray[row+2][column+2],gameArray[row+3][column+3],color))
      {
        console.log("win diagonal"+color);
      }
    }
  }

  for(let column=0;column<4;column++)
  {
    for(let row=5;row>2;row--)
    {
      if(checkMatch(gameArray[row][column],gameArray[row-1][column+1],gameArray[row-2][column+2],gameArray[row-3][column+3],color))
      {
        console.log("win diagonal 2"+color);
      }
    }
  }

 
}

